# install.packages( "tidyverse")
library( tidyverse)
library( lubridate)
my_data <- read_csv("data_raw/votos_10n_por_municipios.csv")
my_data <- read_csv("data_raw/votos_10n_por_municipios.csv")
my_data_2 <- read_csv("data_raw/votos_28a_por_municipios.csv")
my_data
my_data_2
View(my_data)
my_data %>% select(partido)
my_data %>% select(1)
my_data %>% select(2)
my_data %>% select(1:4)
my_data_2
View(my_data)
my_data %>% select(-votos_pc)
my_data %>% select(codigo_mun, partido, contains('votos'))
my_data %>%
mutate( tipo_partido = if_else(partido %in% c( "PSOE", "PP", "VOX", "UP", "Cs"),
"Ámbito nacional",
"Otros")) %>%
distinct(partido, tipo_partido) %>%
View()
View(my_data)
my_data %>% distinct(codigo_mun, blancos, votos)
my_data %>% distinct(codigo_mun, blancos, candidaturas, nulos)
my_data %>% distinct(codigo_mun, .keep_all = T)
my_data %>% distinct(codigo_mun, .keep_all = T) %>% select(-partido)
my_data %>% distinct(codigo_mun, .keep_all = T) %>% select(-partido) %>% mutate(blanco_pc = blancos / (candidaturas + blancos + nulos), nulos_pc = nulos / (candidaturas + blancos + nulos)) %>% slice_max(blanco_pc, nulos_pc)
my_data %>% distinct(codigo_mun, .keep_all = T) %>% select(-partido) %>% mutate(blanco_pc = blancos / (candidaturas + blancos + nulos), nulos_pc = nulos / (candidaturas + blancos + nulos)) %>% slice_max(blanco_pc)
my_data %>% distinct(codigo_mun, .keep_all = T) %>% select(-partido) %>% mutate(blanco_pc = blancos / (candidaturas + blancos + nulos), nulos_pc = nulos / (candidaturas + blancos + nulos)) %>% slice_max(nulos_pc)
?slice_max
my_data %>% distinct(codigo_mun, .keep_all = T) %>% filter(partido=='VOX') %>% slice_max(votos, 10)
my_data %>% distinct(codigo_mun, .keep_all = T) %>% filter(partido=='VOX') %>% slice_max(votos, n=10)
my_data %>% filter(partido=='VOX') %>% slice_max(votos, n=10)
my_data %>% filter(partido=='VOX') %>% slice_max(votos_pc, n=10)
my_data %>% filter(partido=='VOX', censo > 1000) %>% slice_max(votos_pc, n=10)
my_data %>% filter(codigo_mun>=28000 | codigo_mun<29000,  partido=='VOX', censo < 50000) %>% slice_max(votos_pc, n=10)
my_data %>% filter(str_sub(codigo_mun, 28),  partido=='VOX', censo < 50000) %>% slice_max(votos_pc, n=10)
str_sub('28004', '28')
str_sub('28004', '^28')
my_data %>% filter(grepl('^28', codigo_mun),  partido=='VOX', censo < 50000) %>% slice_max(votos_pc, n=10)
my_data %>% group_by(partido) %>% summarize(votos_totales=sum(votos))
my_data %>% group_by(partido) %>% summarize(votos_totales=sum(votos)) %>% arrage(desc(votos_totales))
my_data %>% group_by(partido) %>% summarize(votos_totales=sum(votos)) %>% arrange(desc(votos_totales))
my_data %>% group_by(partido) %>% summarize(votos_totales=sum(votos)) %>% arrange(desc(votos_totales))
my_data %>% group_by(substr(codigo_mun, 1, 2))
data_munis <- my_data %>% distinct(codigo_mun, .keep_all = T) %>% mutate(codigo_prov = str_sub(codigo_mun, 1, 2)) %>% select(codigo_mun:part)
data_munis
data_munis <- my_data %>% distinct(codigo_mun, .keep_all = T) %>% mutate(codigo_prov = str_sub(codigo_mun, 1, 2)) %>% select(codigo_mun:part, codigo_prov)
data_munis
data_munis <- my_data %>% distinct(codigo_mun, .keep_all = T) %>% mutate(codigo_prov = str_sub(codigo_mun, 1, 2)) %>% select(codigo_prov, codigo_mun:part)
data_munis
data_munis %>%  group_by(codigo_prov)
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos))
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos)) %>% ungroup()
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos))
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos))
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos)) %>% mutate(avg= 100 * censo / (candidaturas + blancos + nulos))
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos)) %>% mutate(avg= censo / (candidaturas + blancos + nulos))
data_munis %>%  group_by(codigo_prov) %>% summarise(censo=sum(censo), candidaturas=sum(candidaturas), blancos=sum(blancos), nulos=sum(nulos)) %>% mutate(avg= 100 * (candidaturas + blancos + nulos) / censo)
my_data_2
munis <- read_csv("data_raw/cod_municipios_ine.csv")
munis
munis <- read_delim("data_raw/cod_municipios_ine.csv", delim=";")
View(munis)
munis <- munis %>% mutate(codigo_mun=paste0(CPRO, CMUN))
munis <- read_csv2("data_raw/cod_municipios_ine.csv", delim=";")ç
munis <- read_csv2("data_raw/cod_municipios_ine.csv", delim=";")
munis <- read_csv2("data_raw/cod_municipios_ine.csv")
munis <- munis %>% mutate(codigo_mun=paste0(CPRO, CMUN))
View(munis)
munis <- munis %>% select(codigo_mun, everithing())
munis <- munis %>% select(codigo_mun, everything())
View(munis)
munis <- munis %>% select(codigo_mun, mun=MUNICIPIO, prov=PROVINCIA)
my_data %>% left_join(munis)
my_data %>% left_join(munis) %>% filter(mun='Fuenlabrada')
my_data %>% left_join(munis) %>% filter(mun=='Fuenlabrada')
# install.packages( "tidyverse")
library( tidyverse)
library( lubridate)
my_data <- read_csv("data_raw/votos_10n_por_municipios.csv")
my_data_2 <- read_csv("data_raw/votos_28a_por_municipios.csv")
my_data
my_data_2
View(my_data)
write_csv(my_data, "./my_data_rewritten.csv")
my_data %>%
write_csv("./my_data_rewritten.csv")
select(my_data, codigo_mun, partido, votos_pc) %>%
View()
my_data %>%
select(-codigo_mun)
# Resuélvelos aquí
names(my_data)
my_data %>%
select(-votos_pc)
my_data %>%
select(`Código de municipio` = codigo_mun, partido, contains("voto"))
my_data %>%
rename(`Código de municipio` = codigo_mun)
my_data %>%
mutate( tipo_partido = if_else(partido %in% c( "PSOE", "PP", "VOX", "UP", "Cs"),
"Ámbito nacional",
"Otros")) %>%
distinct(partido, tipo_partido)
my_data %>%
mutate( fecha = lubridate::today())
my_data %>%
mutate( candidato = case_when( partido == "PSOE" ~ "Sánchez",
partido == "PP" ~ "Casado",
partido == "VOX" ~ "Abascal",
partido == "UP" ~ "Iglesias",
partido == "Cs" ~ "Rivera",
partido == "MP" ~ "Errejon",
T ~ "Otros"))
# Resuélvelos aquí
my_data %>%
mutate(votos_validos = candidaturas + blancos)
my_data %>%
distinct( codigo_mun, blancos, nulos)
my_data_with_pc <- my_data %>%
distinct( codigo_mun, .keep_all = T) %>%
mutate(blancos_pc = 100 * blancos / (candidaturas + nulos + blancos),
nulos_pc = 100 * nulos / (candidaturas + nulos + blancos)) %>%
select( codigo_mun, blancos_pc, nulos_pc)
my_data_with_pc %>%
slice_max( nulos_pc, n = 1)
my_data_with_pc %>%
slice_max( blancos_pc, n = 1)
my_data %>%
filter( votos_pc == 100) %>%
View()
my_data %>%
filter( partido == "VOX" & votos_pc > 50) %>%
View()
my_data %>%
filter((partido == "ERC" | partido == "JxCAT") &
votos_pc > 50)
my_data %>%
filter( partido %in% c( "ERC", "JxCAT") &
votos_pc > 50)
# Resuélvelos aquí
una_variable_muy_old <- my_data %>%
mutate(codigo_prov = str_sub(codigo_mun, 1, 2)) %>%
group_by(codigo_prov)
una_variable_muy_old %>%
filter(partido == "VOX") %>%
slice_max(votos_pc, n = 10) %>%
View()
my_data %>%
filter(censo < 50000,
str_sub(codigo_mun, 1, 2) == "28",
partido == "VOX") %>%
arrange( desc( votos_pc)) %>%
select(-blancos:-part)
my_data %>%
distinct( codigo_mun, censo, blancos, nulos, candidaturas) %>%
summarise( censo = sum(censo),
candidaturas = sum(candidaturas),
blancos = sum(blancos),
nulos = sum(nulos))
my_data %>%
summarise( censo = sum(censo),
candidaturas = sum(candidaturas),
blancos = sum(blancos),
nulos = sum(nulos)) %>%
mutate( part = 100 * (candidaturas + blancos + nulos) / censo)
my_data %>%
group_by(partido)
var1 <- my_data %>%
filter(codigo_mun %in% c("01001","01002","01003")) %>%
group_by(partido) %>%
mutate( votos_total = sum( votos)) %>%
ungroup()
var2 <- var1 %>%
mutate(votos_prop=100*votos/votos_total) %>%
select( codigo_mun, partido, votos, votos_prop) %>%
filter( partido != "OTROS") %>%
View()
# Resuélvelos aquí
my_data %>%
group_by(partido) %>%
summarise(votos_totales = sum(votos)) %>%
arrange( desc( votos_totales))
data_munis_10n <- my_data %>%
distinct( codigo_mun, .keep_all = T) %>%
select( codigo_mun:part) %>%
mutate( codigo_prov = str_sub(codigo_mun, 1, 2)) %>%
select(codigo_mun, codigo_prov, everything())
data_munis_28a <- my_data_2 %>%
distinct( codigo_mun, .keep_all = T) %>%
select( codigo_mun:part) %>%
mutate( codigo_prov = str_sub(codigo_mun, 1, 2)) %>%
select(codigo_mun, codigo_prov, everything())
data_munis %>%
group_by(codigo_prov) %>%
summarise(censo = sum(censo),
candidaturas = sum(candidaturas),
blancos = sum(blancos),
nulos = sum(nulos)) %>%
View()
data_munis %>%
mutate(votos_totales = candidaturas + blancos + nulos) %>%
group_by(codigo_prov) %>%
summarise(censo = sum(censo),
votos_totales = sum(votos_totales)) %>%
ungroup() %>%
mutate(part = 100 * votos_totales / censo) %>%
View()
tibble_1 <- tribble(
~key, ~val_1,
"A", 2,
"B", 4,
"C", 6,
"D", 8)
tibble_2 <- tribble(
~key, ~val_2,
"A", 1,
"C", 3,
"E", 5,
"F", 7)
tibble_1 %>%
inner_join(tibble_2)
tibble_1 %>%
left_join(tibble_2)
tibble_1 %>%
right_join(tibble_2)
tibble_1 %>%
full_join(tibble_2)
tibble_1 %>%
anti_join(tibble_2)
# Resuélvelos aquí
dict_munis <- read_csv2("data_raw/cod_municipios_ine.csv") %>%
mutate(codigo_mun = str_glue("{CPRO}{CMUN}")) %>%
select(codigo_mun, mun = MUNICIPIO, prov = PROVINCIA, ccaa = CCAA)
my_data %>%
left_join(dict_munis, by = c( "codigo_mun" = "codigo_mun")) %>%
filter(mun == "Fuenlabrada")
my_data %>%
left_join(dict_munis, by = c( "codigo_mun" = "codigo_mun")) %>%
filter(mun %in% c( "San Juan del Molinillo", "Navarredondilla")) %>%
group_by(partido) %>%
summarise(votos = sum(votos))
data_munis_10n %>%
inner_join(data_munis_28a,
by = c( "codigo_mun", "codigo_prov"),
suffix = c( "_10n", "_28a")) %>%
select(codigo_mun, codigo_prov, starts_with("part_")) %>%
mutate(part_diff = part_10n - part_28a) %>%
slice_min(part_diff, n = 10) %>%
View()
my_data %>%
filter( codigo_mun == "01001") %>%
select( codigo_mun, partido, votos) %>%
View()
my_data %>%
filter( codigo_mun == "01001") %>%
select( codigo_mun, partido, votos) %>%
pivot_wider( names_from = partido, values_from = votos) %>%
View()
my_data %>%
select( codigo_mun, partido, votos, votos_pc) %>%
pivot_wider( names_from = partido, values_from = votos) %>%
View()
aux_1 <- my_data %>%
mutate( election = "10N") %>%
filter( codigo_mun == "01001")
aux_2 <- my_data_2 %>%
mutate( election = "28A") %>%
filter( codigo_mun == "01001")
aux_1 %>%
bind_rows( aux_2) %>%
pivot_wider(id_cols = codigo_mun, names_from = partido, values_from = votos) %>%
View()
my_data %>%
filter( partido == "PSOE") %>%
ggplot() +
geom_point(aes( x = part, y = votos_pc))
my_data %>%
filter( partido == "PSOE") %>%
ggplot() +
geom_histogram(aes( x = votos_pc))
my_data %>%
filter( partido == "PSOE") %>%
ggplot() +
geom_density(aes( x = votos_pc))
my_data %>%
group_by( partido) %>%
summarise( votos = sum(votos)) %>%
ggplot() +
geom_col( aes( x = partido, y = votos))
datos_covid <- read_csv( "https://cnecovid.isciii.es/covid19/resources/casos_tecnica_ccaa.csv")
datos_covid %>%
filter(ccaa_iso == "AN") %>%
ggplot() +
geom_line(aes(x = fecha,y = num_casos))
datos_covid %>%
filter(ccaa_iso == "AN") %>%
ggplot() +
geom_line(aes(x = fecha,y = num_casos),
stat = "smooth",
method = "loess", span = 0.1)
datos_covid %>%
filter(ccaa_iso == "AN",
fecha >= ymd( "2021-12-01")) %>%
ggplot() +
geom_step(aes(x = fecha,y = num_casos))
datos_covid %>%
filter(ccaa_iso == "AN",
fecha >= ymd( "2021-12-01")) %>%
ggplot() +
geom_step(aes(x = fecha,y = num_casos),
color = "red",
size = 1.2)
datos_covid %>%
filter(ccaa_iso == "AN") %>%
ggplot() +
geom_area( aes(x = fecha,y = num_casos),
stat = "smooth",
method = "loess",
span = 0.15,
fill = "darkgreen",
alpha = 0.5,
color = "black")
partidos_nac <- c( "PSOE", "PP", "VOX", "UP", "Cs")
my_data %>%
filter( partido %in% partidos_nac) %>%
ggplot() +
geom_density(aes( x = votos_pc,
color = partido,
fill = partido),
size = 0.5,
alpha = 0.2)
my_data %>%
filter( partido %in% partidos_nac) %>%
ggplot() +
geom_density(aes( x = votos_pc,
color = "partido",
fill = "partido"),
size = 0.5,
alpha = 0.2)
colores <- c("#d7301f", "#2b8cbe", "#41ae76", "#8c6bb1",
"#fe9929", "#7bccc4", "gold", "darkblue",
"olivedrab4", "darkred", "greenyellow",
"yellow", "lightskyblue", "yellow", "forestgreen", "grey" )
names(colores) <- c("PSOE", "PP", "VOX", "UP", "Cs", "MP", "ERC",
"JxCAT", "PRC", "Teruel", "Bildu", "CC",
"BNG", "CUP", "PNV", "OTROS")
g1 <- my_data %>%
left_join( dict_munis) %>%
filter(censo > 1000 & ccaa == "Andalucía" & partido != "OTROS") %>%
mutate( partido = fct_relevel( partido, c( "PSOE", "PP", "VOX", "UP", "Cs", "MP"))) %>%
ggplot(aes( x = censo, y = votos_pc,
size = censo)) +
geom_point(aes(fill=partido),
alpha = 0.7,
color = "white",
shape = 21) +
geom_line(stat="smooth",
method = "lm") +
scale_x_log10() +
scale_y_continuous(limits = c(0, NA)) +
scale_fill_manual( values = colores) +
facet_wrap( ~partido, ncol = 3)
g1 <- g1 +
labs( title="¿Partidos rurales y partidos urbanos en Andalucía?",
subtitle = "Relación entre censo y voto el 10N",
x="Censo",
y="% de voto",
caption = "Fuente: Ministerio del Interior") +
theme_minimal() +
theme(legend.position = "none")
g1
# ggsave( g1, filename = "output/my_graph.png", width = 9, height = 6)
install.packages("ggtext")
# install.packages("ggtext")
library(ggtext)
g1 <- g1 +
labs(title = "¿Partidos rurales y partidos urbanos en Andalucía?",
subtitle = "Relación entre censo y voto el 10N de <span style = 'color:#d7301f;'>PSOE</span>, <span style = 'color:#2b8cbe;'>PP</span>  y demás partidos",
x = "Censo", y = "% de voto",
caption = "Fuente: Ministerio del Interior") +
theme_minimal() +
theme(legend.position = "none",
# Le indicamos que ese subtítulo será HTML
plot.subtitle = element_markdown(face = "bold"))
g1
