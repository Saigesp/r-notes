install.packages('DatawRappr')
install.packages("devtools")
devtools::install_github("munichrocker/DatawRappr")
install.packages('magick')
devtools::install_github("munichrocker/DatawRappr")
library(tibble)
library(dplyr)
#Forma parte de *tidyverse*
library(readr)
aire2021 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306612-calidad-aire-diario.csv")
aire2020 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306609-calidad-aire-diario.csv")
aire2019 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306606-calidad-aire-diario.csv")
aire2018 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-7775096-calidad-aire-diario.csv")
aire2017 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-7775098-calidad-aire-diario.csv")
archivos <- list.files(path = "./Datos/", pattern=".csv")
aire <- tibble()
for (i in archivos) {
aire_year <- read_csv2(paste0("./Datos/", i))
aire <- bind_rows(aire, aire_year)
}
archivos <- list.files(path = "./Datos/", pattern=".csv")
aire_withyear <- tibble()
for (i in archivos) {
aire_year <- read_csv2(paste0("./Datos/", i))
aire_year$year <- substr(i, 6, 9)
aire_withyear <- bind_rows(aire_withyear, aire_year)
}
aire <- bind_rows(aire2017, aire2018, aire2019, aire2020, aire2021)
aire_no2_verificacion <- aire_no2 %>% select(!starts_with("D")) %>%
pivot_longer(starts_with("V"), names_to = "DIA", values_to = "VERIF") %>%
mutate(DIA=as.integer(gsub("V", "", DIA)),
MES=as.integer(MES),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, VERIF, FECHA)
aire_no2_datos <- aire_no2 %>%
select(!starts_with("V")) %>%
pivot_longer(starts_with("D"), names_to = "DIA", values_to = "DATO") %>%
mutate(DIA=as.integer(gsub("D", "", DIA)),
MES=as.integer(MES),
DATO=as.integer(DATO),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, DATO, FECHA)
#Forma parte de *tidyverse*
library(tidyr)
aire_no2 <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(24, 56, 35))
aire_no2_datos <- aire_no2 %>%
select(!starts_with("V")) %>%
pivot_longer(starts_with("D"), names_to = "DIA", values_to = "DATO") %>%
mutate(DIA=as.integer(gsub("D", "", DIA)),
MES=as.integer(MES),
DATO=as.integer(DATO),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, DATO, FECHA)
aire_no2_verificacion <- aire_no2 %>% select(!starts_with("D")) %>%
pivot_longer(starts_with("V"), names_to = "DIA", values_to = "VERIF") %>%
mutate(DIA=as.integer(gsub("V", "", DIA)),
MES=as.integer(MES),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, VERIF, FECHA)
aire_no2 <- full_join(aire_no2_datos, aire_no2_verificacion)
aire_no2 <- aire_no2 %>%
mutate(VALOR=if_else(VERIF=="V", DATO, NA_integer_)) %>%
filter(!is.na(VALOR)) %>%
select(-DATO, -VERIF)
devtools::install_github("munichrocker/DatawRappr")
install.packages('Rtools')
# Chunk 1
#Forma parte de *tidyverse*
library(readr)
library(tibble)
library(dplyr)
# Chunk 2
#Ver información de la función
#help("read_csv2")
# Chunk 3
#Anualmente importamos los datos de 2017-2021
aire2021 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306612-calidad-aire-diario.csv")
aire2020 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306609-calidad-aire-diario.csv")
aire2019 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306606-calidad-aire-diario.csv")
aire2018 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-7775096-calidad-aire-diario.csv")
aire2017 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-7775098-calidad-aire-diario.csv")
# Chunk 4
archivos <- list.files(path = "./Datos/", pattern=".csv")
aire <- tibble()
for (i in archivos) {
aire_year <- read_csv2(paste0("./Datos/", i))
aire <- bind_rows(aire, aire_year)
}
# Chunk 5
archivos <- list.files(path = "./Datos/", pattern=".csv")
aire_withyear <- tibble()
for (i in archivos) {
aire_year <- read_csv2(paste0("./Datos/", i))
aire_year$year <- substr(i, 6, 9)
aire_withyear <- bind_rows(aire_withyear, aire_year)
}
# Chunk 6
aire <- bind_rows(aire2017, aire2018, aire2019, aire2020, aire2021)
# Chunk 7
#Forma parte de *tidyverse*
library(tidyr)
# Chunk 8
aire_no2 <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(24, 56, 35))
# Chunk 9
aire_no2_datos <- aire_no2 %>%
select(!starts_with("V")) %>%
pivot_longer(starts_with("D"), names_to = "DIA", values_to = "DATO") %>%
mutate(DIA=as.integer(gsub("D", "", DIA)),
MES=as.integer(MES),
DATO=as.integer(DATO),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, DATO, FECHA)
# Chunk 10
aire_no2_verificacion <- aire_no2 %>% select(!starts_with("D")) %>%
pivot_longer(starts_with("V"), names_to = "DIA", values_to = "VERIF") %>%
mutate(DIA=as.integer(gsub("V", "", DIA)),
MES=as.integer(MES),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, VERIF, FECHA)
# Chunk 11
aire_no2 <- full_join(aire_no2_datos, aire_no2_verificacion)
# Chunk 12
aire_no2 <- aire_no2 %>%
mutate(VALOR=if_else(VERIF=="V", DATO, NA_integer_)) %>%
filter(!is.na(VALOR)) %>%
select(-DATO, -VERIF)
# Chunk 13
aire_no2_media_mensual <- aire_no2 %>%
mutate(ANO_MES = as.Date(paste(ANO, MES, 1, sep="-"))) %>%
group_by(ANO_MES, ESTACION) %>%
summarise(MEDIA_MENSUAL = mean(VALOR, na.rm = T))
# Chunk 14
aire_no2_media_mensual <- aire_no2_media_mensual %>%
group_by(ESTACION) %>%
mutate(VAR_MENSUAL = (MEDIA_MENSUAL-lag(MEDIA_MENSUAL))/lag(MEDIA_MENSUAL)*100)
# Chunk 15
aire_no2_122021 <- aire_no2_media_mensual %>% filter(ANO_MES=="2021-12-01")
# Chunk 16
casadecampo_122021 <- (aire_no2_122021 %>% filter(ESTACION==24))$MEDIA_MENSUAL
plazaeliptica_122021 <- (aire_no2_122021 %>% filter(ESTACION==56))$MEDIA_MENSUAL
plazaeliptica_122021-casadecampo_122021
# Chunk 17
library(DatawRappr)
# Chunk 18
datawrapper_auth(
api_key = **TU TOKEN**,
overwrite = TRUE)
# Chunk 19
aire_no2_122021 <- aire_no2_122021 %>% mutate(
NOMBRE=case_when(ESTACION==24 ~ "Casa de Campo",
ESTACION==56 ~ "Plaza Elíptica",
ESTACION==35 ~ "Plaza del Carmen",
TRUE ~ "Otra")) %>%
ungroup() %>% select(NOMBRE, MEDIA_MENSUAL) %>% arrange(desc(MEDIA_MENSUAL))
# Chunk 20
#No recomendable, se nos van a crear muchos y no controlamos en qué carpeta se nos crea
#mi_grafico <- dw_create_chart()
# Chunk 21
dw_data_to_chart(aire_no2_122021, "BhPGn")
dw_edit_chart("BhPGn",
type = "d3-bars",
title = "La contaminación en el aire de Madrid",
intro = "Nivel de Dióxido de Nitrógeno (NO2 µg/m3) en tres estaciones de medición de Madrid. Media de los registros diarios de diciembre de 2021",
source_name = "Ayuntamiento de Madrid",
source_url = "https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=aecb88a7e2b73410VgnVCM2000000c205a0aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default")
#dw_publish_chart("BhPGn")
# Chunk 22
#Librería para fechas
library(lubridate)
View(aire_no2)
mi_aire <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(24, 56, 35))
mi_aire <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(25))
View(mi_aire)
mi_aire <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(24))
aire_no2 <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(24, 56, 35))
View(aire_no2)
# Chunk 1
#Forma parte de *tidyverse*
library(readr)
library(tibble)
library(dplyr)
# Chunk 2
#Ver información de la función
#help("read_csv2")
# Chunk 3
#Anualmente importamos los datos de 2017-2021
aire2021 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306612-calidad-aire-diario.csv")
aire2020 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306609-calidad-aire-diario.csv")
aire2019 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-10306606-calidad-aire-diario.csv")
aire2018 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-7775096-calidad-aire-diario.csv")
aire2017 <- read_csv2("https://datos.madrid.es/egob/catalogo/201410-7775098-calidad-aire-diario.csv")
# Chunk 4
archivos <- list.files(path = "./Datos/", pattern=".csv")
aire <- tibble()
for (i in archivos) {
aire_year <- read_csv2(paste0("./Datos/", i))
aire <- bind_rows(aire, aire_year)
}
# Chunk 5
archivos <- list.files(path = "./Datos/", pattern=".csv")
aire_withyear <- tibble()
for (i in archivos) {
aire_year <- read_csv2(paste0("./Datos/", i))
aire_year$year <- substr(i, 6, 9)
aire_withyear <- bind_rows(aire_withyear, aire_year)
}
# Chunk 6
aire <- bind_rows(aire2017, aire2018, aire2019, aire2020, aire2021)
# Chunk 7
#Forma parte de *tidyverse*
library(tidyr)
# Chunk 8
aire_no2 <- aire %>%
filter(MAGNITUD==8,
ESTACION %in% c(24, 56, 35))
# Chunk 9
aire_no2_datos <- aire_no2 %>%
select(!starts_with("V")) %>%
pivot_longer(starts_with("D"), names_to = "DIA", values_to = "DATO") %>%
mutate(DIA=as.integer(gsub("D", "", DIA)),
MES=as.integer(MES),
DATO=as.integer(DATO),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, DATO, FECHA)
# Chunk 10
aire_no2_verificacion <- aire_no2 %>% select(!starts_with("D")) %>%
pivot_longer(starts_with("V"), names_to = "DIA", values_to = "VERIF") %>%
mutate(DIA=as.integer(gsub("V", "", DIA)),
MES=as.integer(MES),
FECHA=as.Date(paste(ANO, MES, DIA, sep="-"))) %>%
select(ESTACION, PUNTO_MUESTREO, ANO, MES, DIA, VERIF, FECHA)
# Chunk 11
aire_no2 <- full_join(aire_no2_datos, aire_no2_verificacion)
# Chunk 12
aire_no2 <- aire_no2 %>%
mutate(VALOR=if_else(VERIF=="V", DATO, NA_integer_)) %>%
filter(!is.na(VALOR)) %>%
select(-DATO, -VERIF)
View(aire_no2)
aire_no2 %>% group_by(ESTACION, MES) %>% summarise(avg=mean(VALOR))
View(aire_no2 %>% group_by(ESTACION, MES) %>% summarise(avg=mean(VALOR)))
